---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: docker-private-registry
  name: docker-private-registry-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: docker-private-registry
  template:
    metadata:
      labels:
        app: docker-private-registry
    spec:
      containers:
      - image: registry:2
        imagePullPolicy: IfNotPresent
        name: docker-private-registry
        env:
        - name: REGISTRY_HTTP_ADDR
          value: 0.0.0.0:5000
        - name: REGISTRY_HTTP_TLS_CERTIFICATE
          value: /certs/cert.crt
        - name: REGISTRY_HTTP_TLS_KEY
          value: /certs/cert.key
        ports:
        - containerPort: 5000
          protocol: TCP
        volumeMounts:
        - mountPath: /var/lib/registry
          name: image-store
        - mountPath: /certs
          name: certs
      volumes:
      - emptyDir: {} # THIS IS NOT PERSISTENT! WILL DELETE WITH POD!
        name: image-store
      - name: certs
        secret:
          secretName: registry-tls
          items:
          - key: tls.crt
            path: cert.crt
            mode: 256 # 0400 in decimal
          - key: tls.key
            path: cert.key
            mode: 256 # 0400 in decimal
---
apiVersion: v1
kind: Service
metadata:
  labels:
    service: docker-private-registry
  name: docker-private-registry
spec:
  ports:
  - nodePort: 30500
    port: 5000
    protocol: TCP
    targetPort: 5000
  selector:
    app: docker-private-registry
  type: NodePort

---
apiVersion: v1
kind: Secret
data:
  tls.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUVERENDQXZTZ0F3SUJBZ0lVVld0TnZYR3dvZFlONERlK2V4Q0o3d3VsWE1Bd0RRWUpLb1pJaHZjTkFRRUwKQlFBd2NERUxNQWtHQTFVRUJoTUNWVk14RlRBVEJnTlZCQWdUREZCbGJtNXplV3gyWVc1cFlURVRNQkVHQTFVRQpCeE1LU0dGeWNtbHpZblZ5WnpFVE1CRUdBMVVFQ2hNS1MzVmlaWEp1WlhSbGN6RUxNQWtHQTFVRUN4TUNRMEV4CkV6QVJCZ05WQkFNVENrdDFZbVZ5Ym1WMFpYTXdIaGNOTWpBd05ESTNNVGt6TnpBd1doY05NakV3TkRJM01Ua3oKTnpBd1dqQnhNUXN3Q1FZRFZRUUdFd0pWVXpFVk1CTUdBMVVFQ0JNTVVHVnVibk41YkhaaGJtbGhNUk13RVFZRApWUVFIRXdwSVlYSnlhWE5pZFhKbk1STXdFUVlEVlFRS0V3cExkV0psY201bGRHVnpNU0V3SHdZRFZRUUxFeGhMCmRXSmxjbTVsZEdWeklGUm9aU0JCYkhSaE15QlhZWGt3Z2dFaU1BMEdDU3FHU0liM0RRRUJBUVVBQTRJQkR3QXcKZ2dFS0FvSUJBUUNuUVdVMWN0TnlHT05xSlZMTjNBNW1tVEJPYTNOR3ovNGE1d1JPUnpwOXVaTTQ0eHNoOFV5RwpyVnJYOE9pTzJMRm5acStBRWdjK1RiakRiaWRIeWVvcVE3TnI1R0w3eDhXY0VJWG96SkFNckUreS9TTmo0L0RXCkJxMGNteUxhcENkaDk5Mm1pYlVWTWYxOUdyTVdZU1k1VlgxcUtXZTdQamZzendQc2tiT0l1UFI0ckV0Y1pCRnMKSjlJVlVKb253ckJ0R3BPa0IyS09WRFBBTFYyKzZUWHMwTUFnd3JVQyt1dXVGZSs5MGhrQ3ZHUG9IdjF6YlZLSQpZZ0hHeFR1V29KTUM1dk9PdkVWM3hCaU9BYWlaVDZNdEJwWXpCZno4MHBoYUVvbFROSkJDN3JKSzh4MDgzb3FJCko5OHZSd0VjSmdCRDhBamNpTTZ1QXdiTEJ0UXRZb09aQWdNQkFBR2pnWnd3Z1prd0RnWURWUjBQQVFIL0JBUUQKQWdXZ01CMEdBMVVkSlFRV01CUUdDQ3NHQVFVRkJ3TUJCZ2dyQmdFRkJRY0RBakFNQmdOVkhSTUJBZjhFQWpBQQpNQjBHQTFVZERnUVdCQlRVZko4NEpjLy9mK2NtdUxFQVYxNTJ3N3F2Q2pBZkJnTlZIU01FR0RBV2dCVE50d2lZCmkrU0VaZDFqZ1FJcW1IZUpaSG96S1RBYUJnTlZIUkVFRXpBUmdnbHNiMk5oYkdodmMzU0hCSDhBQUFFd0RRWUoKS29aSWh2Y05BUUVMQlFBRGdnRUJBSFNMUllIaGJKSWJaUHpqMG5VZHFUZGtwc2NSSTlLY1E2QWRUTUMzUHpscAo5U1hqVnpwNEtORUxabitaOVJmVWYyZjZGTFphbHVMTW9PbEJsejE3MTRzUXFnSnk4LzluSnIrbGdlamNiMFMrCmQ2eG84RHhmUGk2RGxlYkxJdHROSDBzdGxRUk9rOFpHZktxWmFnZGFEMXdvK21qYWl0VWhtdkpzUUZaSll6L0YKU0ROZFk1UG1LeG1IT2FtQkJyd214UUNYYk96VjZWMTR3dnN5THpaN2dubWswS0MyKzlJTnJTWFpXQkcvNUxjTAp6NzhLRkJJeU5VSVpLbHVVd2NuWkFQcEtTZEFlYlhnOU1nOExoTk14Tit5OERQdlpidWJIemdkMmRGWnFOMzgwClNpT0JzditGbXJBQ0tqL2hjYW1veEtFMU1ueWdKMkhXZjI2MXZob3puMU09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
  tls.key: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBcDBGbE5YTFRjaGpqYWlWU3pkd09acGt3VG10elJzLytHdWNFVGtjNmZibVRPT01iCklmRk1ocTFhMS9Eb2p0aXhaMmF2Z0JJSFBrMjR3MjRuUjhucUtrT3phK1JpKzhmRm5CQ0Y2TXlRREt4UHN2MGoKWStQdzFnYXRISnNpMnFRbllmZmRwb20xRlRIOWZScXpGbUVtT1ZWOWFpbG51ejQzN004RDdKR3ppTGowZUt4TApYR1FSYkNmU0ZWQ2FKOEt3YlJxVHBBZGlqbFF6d0MxZHZ1azE3TkRBSU1LMUF2cnJyaFh2dmRJWkFyeGo2Qjc5CmMyMVNpR0lCeHNVN2xxQ1RBdWJ6anJ4RmQ4UVlqZ0dvbVUrakxRYVdNd1g4L05LWVdoS0pVelNRUXU2eVN2TWQKUE42S2lDZmZMMGNCSENZQVEvQUkzSWpPcmdNR3l3YlVMV0tEbVFJREFRQUJBb0lCQUFRbVVUYUVSTTY5NDFhTQoyb01WQko1ekNvbkhqTEtqRW5Ea2JtenF3MzYvRGZJSllIRDFKYXJwdmlsQlp1TzBhS0ppSDlTVG5lNWp5ME8rCkJlZDRFUUUvY01JcWhuSXN3TEJna0pINEVWTGZLNU1MU01kL3JrZ0JIbVpwU3ZJVnhJeGZzL1lmMEloWUZ5djEKYjZBTWhRQkRLTHRyajVGTHQrTitOMkMxTkxrZG8xNTdNaVBqbjdmY2N2YXdJSTlGTDMwOFZ2dGRkTHNtUHBUNwo3dlR2TC8rWG54TitCc3lHM3RJZEd3Q2Nzcml0eThSeHh1U2MyckNSNzFOWW9IeGRONkV4NjJFQWpwaXRlUis4ClBiU0ROWjRuUEYwTVhDS2c0TXVJZXFSeENSU0t4RG5yUHhhQXYzeFIzV0hHQVdYWFBXSWZ3RU5ueGIxa3I3WUUKVjNvTUJTRUNnWUVBelZPWE5UTHJtM3RWK1RoSklGR2ZEcWcreUxjWGpROGxVYlQ0VkIzVjJSMEZrcUx5NkhNOQppamY2WGE3YVhLSWl0YnpvQTAxQzlHaTJMU2NDYUxyYnJvR3NwQS9TaG5QSk5KTHZqWjR3RktSYm8wTERpQlJCClpJeVVOOW4wbGZZWWgyTThTZ2Z6VW5HN3NhbHMrNitNeS9CeURpRmZUOFpZUElzK0tTSEtNMTBDZ1lFQTBJaC8KR3JiajVjNG4vc2tGRTBlSmlOT3ZYQ0lWU2prZ0lESjhob0JPR1UzT2lVTVI0UEVYT2FHU3ZFd2FLYjFvelo2SQpvdDEzbjdYRnF0dVlwK0RhbnRuSDZ1Y21SRlRrNFVWN3JlbXBJK09JM0RqaU95RVdMSDdqRGFENTFZWjcvWFE4CkxVMkJhNDl3b2hZcUljbTBGM1VCaWlMQXhqTXNDSHc3cmlJSDZXMENnWUVBeXJSSGh5R3FNR2xteXcraVFlSFMKb1dtLzhlK3Z0SGJMWlFyQVRtclYvKzRDM20wNFdmdkxPWFZpR3JMUXFMcjRnV3Jwc3JqSDdQcWpQNWhQYkkxcwo2NjdoZldhUmRHTkN0RUNMZHNoQXQyQTdoOFlWdTNZanlOeHdSMk5KYi9MdzdGZ3Y0UFpRWllnYXdKNS9GVXFPCk9aZzdRVy80NUl6djkzV1AvSk43UjVFQ2dZQlk4MUJjWWRVV2FuaXUrcW82amhKQmxpSkFCNTNUT2tqVTB4UkEKL3l2UktWcEhQSis4dHJvMGNCSTZWYS8zUy84UGJtZFVLV25rYTFIMHpwVHdUejZSOGMyUUNxZE5FSFZORGlseQpockFLU2YxUUNzZWRkMENSSEZMWHRtbTdSaEZQakt3Nm1zdnd5SSsvNC9wMnpTWVB0MjQvc1JGUHVmWTNiRjY4CnFYRjhoUUtCZ1FDUnA1VmRYdTNwaGJvaUZPVnoxb0NWazVVSUd6MmVIQTFtK0VIeHAzelE2akw4c1RTQ1dQNDMKTHpRNDVEYlFUSW5YcjZFR0NjRE45WkpGanRwSTBVeHlwbHhNU2tCZUU3SGhoaW16V29zeFhMblRSdHd3NWIyMQpjTnhnNUVhK2xpTEo2OWM1UXJOeGlNOWRaMXNid2l2TytqQ2oyU1FDb3FBdUtYZEJ2RjJWT3c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
metadata:
  name: registry-tls
  namespace: default
type: Opaque

